---
output: github_document
---

```{r include=FALSE}
library(YQzuoye)
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

# YQzuoye <img src="logo.png" align="right" alt="" width="120" />

为了更高效的算算算、画画画。

## Installation

```{r, eval = FALSE}
devtools::install_local("~/Nutstore Files/17zuoyegit/YQzuoye_0.1.3.tar.gz")
library(YQzuoye)
```

## Usage

### IRT
```{r, eval = FALSE}
# 基础irt模型
yq_irt(input)
# input is a list, conclude item dimension information, score data and other configuration information.

# 题目信息量
teminfox(Theta,
  it,
  model = "undefined",
  D = 1,
  total.info = TRUE
)
# 测验信息量
testinfox(
  it = as.matrix(par.x[, -1]),
  Theta,
  individual = FALSE,
  model = "undefined",
  which.items = 1:nrow(it)
)
```
### 增值评价

```{r}
data <- data.frame(`2018年-认知` = rnorm(1000), `2019年-认知` = rnorm(1000, 1, 1) + rnorm(1000), 学校 = rep(paste0("班级", 1:20), each = 50), dim_name = "认知")
# 增值结果
res <- hlm_value_added(data, group = "学校", pre = 1, after = 2, time = c("2018", "2019"), dim_name = "认知")

str(res)


```

###  学习品质

```{r, eval = FALSE}

# 坚韧性
tenacity(input_data, P = 0.6)

# 时间管理
time_manage(input_data)

# 专注性
concentrate(input_data, set_time = T)

# 数据清洗
check_pen(data) # 检查点阵笔作答时间

clean_paper(data) # 清洗试卷信息表

clean_pen(data = data,dayinfo = dayinfo) #根据作答时间清洗点阵笔数据

```

###  报告生产工具

####  数据处理与统计计算
```{r}
#保留两位便捷函数
mean2(4.5567) 
sd2(rnorm(100))
cvf(rnorm(100))

# 四舍五入
round2(1.25,1)
round(1.25,1)

# irt之前的重编码数据，使数据从0开始。
recode2(c(1,2,4,5)) 

# 归一化
scaleone(seq(-3,3,0.5)) # x需为z分数
toone(rnorm(10)) # 任意分数归一化

# Z转3等级
zto3(data.frame(x1=seq(-3,3,0.5),x2=seq(-3,3,0.5))) #zscore must be a matrix or data.frame

# 根据四分位数转4等级
torank(seq(-3,3,0.1)) # input_data is a vector

# outlier处理
cap_outlier(seq(-3,3,0.1))

# 百分等级
percentile_rank(seq(-3,3,0.1))

# 几何平均数
geom_mean(c(40,52,65,75,86,97))
# same as:
psych::geometric.mean(c(1.3,1.25,1.154,1.147,1.128))

geom_mean(data.frame(d1=c(40,52,65,75,86,97),d2=c(40,52,65,75,86,97)),by_row=F)

```
####  画图工具
```{r}
data <- data.frame(x = paste0("班级", 1:10), y = rnorm(10, 0, 5))
# 增值量柱状图
bar_1(data) + theme_bw()

# macbook needs to set font style
fontset()
bar_1(data) + theme_bw()


```

```{r}
data <- data.frame(x = c("坚韧性", "专注性", "时间管理"), y = rnorm(3, 10, 5))
# 普通柱状图
bar_2(data) + theme_bw()
```

```{r}
# 带误差线的柱状图

data(bar_data)
# 分面柱形图
bar_error(data = dat_p, x = "等级", xname = "坚韧性等级", yname = "作业平均得分率", facet_rows = "facet") + theme_bw()
# 更换颜色
bar_error(data = dat_p, x = "等级", xname = "坚韧性等级", yname = "作业平均得分率", group = NULL, fill_color = "#DEA9CC", facet_rows = "facet") + theme_bw()
# 根据年级分组，根据年级填色
bar_error(data = dat_p, x = "等级", xname = "坚韧性等级", yname = "作业平均得分率", group = dat_p$年级, fill_color = c("#009B9F", "#DEA9CC"), facet_rows = "facet") + theme_bw()
# 按年级分组，按年级填色，按学科分面
bar_error(data = dat_p, x = "等级", xname = "坚韧性等级", yname = "作业平均得分率", group = dat_p$年级, fill_color = c("#009B9F", "#DEA9CC"), facet_rows = "学科") + theme_bw()
#'
```


```{r}
# 折线图
data <- data.frame(作业顺序_ = rep(c(2018:2020), 3), IRT均值 = rnorm(9, 10, 5), 班级 = rep(paste0("班级", 1:3), each = 3))
line_dot_1(data = data, x = "作业顺序_", y = "IRT均值", group = "班级", title = "", ytitle = "IRT均值", xtitle = "作业次数") + theme_plot1()

```

```{r}
# 普通横向堆积条形图
data(plot_dat)
dat <- stack_plot_dat
# 不需要拉线
stack_plot(
  data = dat, y = dat$率,
  x = dat$班级, label = dat$率x, fill = factor(dat$标签), facet_rows = "维度"
) + theme_light()

# 如果需要拉线，则需增加累积值这一列数据
dat$率[1] <- 0.01
dat$率[2] <- 0.02
dat$率[4] <- 0.025

dat <- dat %>%
  group_by(班级) %>%
  mutate(累积值 = cumsum(率))
stack_plot(
  data = dat, y = dat$率,
  x = dat$班级, label = dat$率x, fill = factor(dat$标签), facet_rows = "维度", low_line = T
) +
  theme_bw() +
  coord_flip()

```

```{r}
# 垂直D等级分界-堆积条形图
data(plot_dat)
dat <- stack_plot_dat
stack_plot_cut(
  data = dat, y = ifelse(dat$标签 %in% c("1"), -dat$率, dat$率),
  x = dat$班级, label = dat$率x, fill = factor(dat$标签), facet_rows = "维度"
) + theme_bw()

```

```{r}
# 水平D等级分界-堆积条形图
data(plot_dat)
dat <- stack_plot_dat
stack_plot_cut_v(
  data = dat, y = dat$班级,
  x = ifelse(dat$标签 %in% c("1"), -dat$率, dat$率), label = dat$率x, fill = factor(dat$标签), facet_rows = "维度"
) + theme_bw()

# 换一种样式
stack_plot_cut_v(
  data = dat, y = dat$班级,
  x = ifelse(dat$标签 %in% c("1"), -dat$率, dat$率), label = dat$率x, fill = factor(dat$标签), facet_rows = "维度"
) + theme_plot1()
```









